<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <title>Users</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" type="image/gif" href="imgOP/gif001.gif">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" /> -->
    <link rel="stylesheet" href="/admin_addstaff.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        body {
            margin: 20px;
        }
        .navbar, .table, .btn {
            margin-bottom: 20px;
        }
    </style>
    <script>
    $(document).ready(function() {
        // Function to filter table rows based on search input
        $('#searchInput').on('input', function() {
            var query = $(this).val().toLowerCase();
            $('tbody tr').each(function() {
                var rowText = $(this).text().toLowerCase();
                $(this).toggle(rowText.includes(query));
            });
        });

        // Initialize event handlers
        function initEventHandlers() {
            // Edit button click event
            $(document).on('click', '.edit-btn', function() {
                var $row = $(this).closest('tr');
                $row.data('original', $row.html()); // Store the original row HTML
                $row.find('.editable').each(function() {
                    var $cell = $(this);
                    var cellText = $cell.text();
                    
                    if ($cell.hasClass('userType')) {
                        // Replace userType cell with a dropdown
                        $cell.html(`
                            <select class="form-control">
                                <option value="admin" ${cellText === 'admin' ? 'selected' : ''}>Admin</option>
                                <option value="staff" ${cellText === 'staff' ? 'selected' : ''}>Staff</option>
                                <option value="guidance officer" ${cellText === 'guidance officer' ? 'selected' : ''}>Guidance Officer</option>
                                <option value="department head" ${cellText === 'department head' ? 'selected' : ''}>Department Head</option>
                            </select>
                        `);
                    } else {
                        $cell.html('<input type="text" class="form-control" value="' + cellText + '">');
                    }
                });
                $row.find('.img-thumbnail').replaceWith('<input type="file" class="form-control-file" name="image">');
                $(this).hide();
                $row.find('.save-btn').show();
                $row.find('.cancel-btn').show();
            });

            // Save button click event
            $(document).on('click', '.save-btn', function() {
                var $row = $(this).closest('tr');
                var formData = new FormData();
                formData.append('id', $row.find('.id').text());
                formData.append('name', $row.find('.name input').val());
                formData.append('username', $row.find('.username input').val());
                formData.append('password', $row.find('.password input').val());
                formData.append('userType', $row.find('.userType select').val());
                
                $.ajax({
                    url: '/studentsViolation/updateUser',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        // On success, update the row with new values and switch back to view mode
                        $row.find('.editable').each(function() {
                            var $cell = $(this);
                            var newValue = $cell.find('input').val() || $cell.find('select').val();
                            $cell.html(newValue);
                        });

                        $row.find('.edit-btn').show();
                        $row.find('.save-btn').hide();
                        $row.find('.cancel-btn').hide();
                    }
                });
            });

            // Cancel button click event
            $(document).on('click', '.cancel-btn', function() {
                var $row = $(this).closest('tr');
                $row.html($row.data('original')); // Restore the original row HTML
                $row.find('.edit-btn').show();
                $row.find('.save-btn').hide();
                $row.find('.cancel-btn').hide();
            });

            // Initial hide of save and cancel buttons
            $('.save-btn').hide();
            $('.cancel-btn').hide();
        }

        // Initialize event handlers on page load
        initEventHandlers();

        // Display alerts from URL parameters
        var successMessage = /*[[${param.successMessage}]]*/ null;
        var errorMessage = /*[[${param.errorMessage}]]*/ null;

        if (successMessage) {
            Swal.fire(successMessage);
        }
        if (errorMessage) {
            Swal.fire(errorMessage);
        }
    });
    </script>
</head>
<body>
<header>

        <div class="user">
            <img src="/bcc.jpg" alt="">
            <h3 style="letter-spacing: 4px; font-size: 1.5rem;">ADMINISTRATOR</h3>
        </div>
        <!-- <span class="menutext">menu</span> -->

        <nav class="navbar">
            <ul>
         
                <li >
                    <i class="fa-solid fa-table-cells" id="active"></i>
                    <form th:action="@{/studentsViolation/dashboard}" method="get" id="dashboard-form">
			            <a class="nav-link" href="#" onclick="formSubmit(5)">DASHBOARD</a>
			        </form>
                </li>

                <li>
                    <i class="fa-solid fa-users"></i>
                    <form th:action="@{/studentsViolation/users}" method="get" id="users-form">
			            <input type="hidden" name="status" value="disabled">
			            <a class="nav-link" href="#" onclick="formSubmit(2)">USERS</a>
			        </form>
                </li>

                <li>
                    <i class="fa-solid fa-book"></i>
                    <form th:action="@{/studentsViolation/records}" method="get" id="records-form">
			        	<a class="nav-link" href="#" onclick="formSubmit(3)">RECORDS</a>
			        </form>
                </li>

                <li>
                    <i class="fa-solid fa-calendar-days"></i>
                    <form th:action="@{/studentsViolation/academicYear}" method="get" id="acadYear-form">
			        	<a class="nav-link" href="#" onclick="formSubmit(4)">ACADEMIC YEAR</a>
			        </form>
                </li> 
                <li>
                    <i class="fa-solid fa-file-circle-check"></i>
                    <form th:action="@{/studentsViolation/reports}" method="get" id="reports-form">
			        	<a class="nav-link" href="#" onclick="formSubmit(6)">REPORTS</a>
			        </form>
                </li>
                <li>

                    <i class="fa-solid fa-user"></i>
                     <form th:action="@{/studentsViolation/userAccount}" method="get" id="userAcc-form">
			        	<a class="nav-link" href="#" onclick="formSubmit(7)">USER ACCOUNT</a>
			        </form>
                </li>
               

                <div class="div">
                  <span></span>
                </div>

                
                <li>  
                    <i class="fa-solid fa-door-open"></i>
        <form th:action="@{/studentsViolation/logout}" method="post" id="logout-form">
        	<a class="nav-link" href="#" onclick="formSubmit(1)">LOGOUT</a>
        </form>
                </li>


            </ul>
        
        </nav>

    </header>
    <div id="menu" class="fas fa-bars"></div>
 

<h1>List of Users</h1>

<form th:action="@{/getEnabledUsers}" method="get">
    <button id="enabledUsersBtn" class="btn btn-secondary">Enabled Users</button>
</form>

<form th:action="@{/getDisabledUsers}" method="get">
    <button id="disabledUsersBtn" class="btn btn-secondary">Disabled Users</button>
</form>

<!-- Search Input -->
<input type="text" id="searchInput" placeholder="Search users...">

<!-- Table Structure -->
<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Username</th>
            <th>Password</th>
            <th>User Type</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Thymeleaf Iteration -->
        <tr th:each="user : ${users}">
            <td class="id" th:text="${user.id}"></td>
            <td class="editable name" th:text="${user.name}"></td>
            <td class="editable username" th:text="${user.username}"></td>
            <td class="editable password" th:text="${user.password}"></td>
            <td class="editable userType">
                <span th:text="${user.userType}"></span>
                <!-- The dropdown will be inserted here during editing -->
            </td>
            <td>
                <button class="btn btn-secondary edit-btn">Edit</button>
                <form th:action="@{/studentsViolation/softDeleteUser}" method="post" style="display:inline;">
                    <input type="hidden" name="id" class="form-control" th:value="${user.id}" />
                    <button class="btn btn-secondary dlt-btn">Delete</button>
                </form>
                <button class="btn btn-secondary save-btn">Save</button>
                <button class="btn btn-secondary cancel-btn">Cancel</button>
            </td>
        </tr>
    </tbody>
    
</table>
<script>
     function formSubmit(formType) {
    	if (formType === 1) {
    		document.getElementById('logout-form').submit();
    	} else if (formType === 2) {
    		document.getElementById('users-form').submit();
    	} else if (formType === 3) {
    		document.getElementById('records-form').submit();
    	} else if (formType === 4) {
    		document.getElementById('acadYear-form').submit();
    	}else if (formType === 5) {
    		document.getElementById('dashboard-form').submit();
    	}else if (formType === 6) {
    		document.getElementById('reports-form').submit();
    	}else if (formType === 7) {
    		document.getElementById('userAcc-form').submit();	
    	}
    	
    	
    	
    }
    
        $(document).ready(function(){
    $('#menu').click(function(){
    $(this).toggleClass('fa-times');
    $('header').toggleClass('toggle');
    
    $(window).on('scroll load',function(){
    
    $('#menu').removeClass('fa-times');
    $('header').removeClass('toggle');  
    });     
    });
});
    </script>
</body>
</html>
